FROM php:8.1-apache

RUN docker-php-ext-install mysqli pdo pdo_mysql
RUN a2enmod rewrite

# Enable .htaccess or RCE rules
RUN sed -i 's/AllowOverride None/AllowOverride All/g' /etc/apache2/apache2.conf

# Fix uploads folder permissions
COPY . /var/www/html/
RUN mkdir -p /var/www/html/uploads
RUN chown -R www-data:www-data /var/www/html/
RUN chown -R www-data:www-data /var/www/html/uploads
RUN chmod -R 777 /var/www/html/
RUN chmod -R 777 /var/www/html/uploads

# Fix Apache logs (for log poisoning)
RUN mkdir -p /var/log/apache2
RUN chmod -R 777 /var/log/apache2
RUN touch /var/log/apache2/access.log
